# ðŸš¨ What is Alertmanager?

**Alertmanager** is the **alerting component** of the Prometheus ecosystem.
It is responsible for **handling alerts** generated by Prometheus servers and **sending notifications** to external systems.

It provides:

* **Routing** â†’ decide where alerts go (Slack, Email, PagerDuty, etc.)
* **Grouping** â†’ combine related alerts into a single notification
* **Silencing** â†’ temporarily mute alerts during maintenance
* **Deduplication** â†’ avoid spamming users with repeated alerts

ðŸ‘‰ Prometheus **detects the problem**, but Alertmanager **tells humans (or systems) about it**.

---

## ðŸ§ Why Do We Need Alertmanager?

Without Alertmanager:

* Prometheus can **trigger alerts**, but it doesnâ€™t know how to notify people.
* Each alert would generate **raw, unorganized messages**.

Challenges Alertmanager solves:

* **Too many alerts** â†’ group and deduplicate.
* **Wrong people notified** â†’ route to the right team.
* **Alert fatigue** â†’ silence during maintenance.

ðŸ‘‰ Itâ€™s the **traffic controller** for alerts.

---

## ðŸ”§ How Alertmanager Works

1. **Prometheus evaluates alert rules** (`.rules` or `.yml` files).
2. If a rule fires, Prometheus sends an **alert** to Alertmanager via HTTP.
3. Alertmanager:

    * Groups related alerts.
    * Applies **routing rules** (e.g., critical â†’ PagerDuty, warnings â†’ Slack).
    * Sends notifications.

4. Users acknowledge alerts, silence them if needed, or take action.

---

### ðŸ”— Architecture Overview

```text
+-------------------+
| Prometheus Server |  -->  Fires alerts
+---------+---------+
          |
          v
+---------+---------+
| Alertmanager      |
| - Grouping        |
| - Routing         |
| - Silencing       |
| - Deduplication   |
+---------+---------+
   |   |   |   |
   v   v   v   v
 Email Slack PagerDuty Webhook
```

---

## ðŸ”„ Alert Flow: From Prometheus â†’ Alertmanager â†’ User

```mermaid
sequenceDiagram
    participant Prom as Prometheus
    participant AM as Alertmanager
    participant User as User (SRE/DevOps)

    Prom->>AM: Send alert (HTTP POST)
    AM->>AM: Group, Deduplicate, Silence
    AM->>User: Send notification (Slack/Email/PagerDuty)
    User->>AM: Silence/Ack alert (optional)
```

---

## ðŸ“œ Example Alert Rule in Prometheus

```yaml
groups:
  - name: node.rules
    rules:
      - alert: HighCPUUsage
        expr: rate(node_cpu_seconds_total{mode="user"}[1m]) > 0.9
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High CPU usage on {{ $labels.instance }}"
          description: "CPU usage > 90% for more than 2 minutes."
```

ðŸ‘‰ When this condition is true, Prometheus sends an **alert** to Alertmanager.

---

## âš™ï¸ Alertmanager Configuration

Alertmanager is configured using a **YAML file** (`alertmanager.yml`).

### Example Config

```yaml
global:
  resolve_timeout: 5m

route:
  receiver: 'slack-notifications'
  group_by: ['alertname', 'cluster']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h

receivers:
  - name: 'slack-notifications'
    slack_configs:
      - channel: '#alerts'
        send_resolved: true
        text: "ðŸ”¥ Alert: {{ .CommonAnnotations.summary }}"

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'cluster']
```

---

### ðŸ”Ž Explanation of Key Fields

* **global** â†’ default settings (timeouts, SMTP server, Slack API URL).
* **route** â†’ defines alert routing rules.

  * `group_by` â†’ group alerts by label.
  * `group_wait` â†’ wait before sending to group alerts.
  * `repeat_interval` â†’ resend alert if still firing.
* **receivers** â†’ list of destinations (Slack, email, PagerDuty).
* **inhibit\_rules** â†’ suppress lower-priority alerts if a higher one is firing.

---

## ðŸ”” Notification Integrations

Alertmanager supports many integrations out of the box:

* ðŸ“§ **Email**
* ðŸ’¬ **Slack, Microsoft Teams, Discord**
* ðŸ“± **PagerDuty, OpsGenie, VictorOps**
* â˜ï¸ **Webhook receivers** â†’ integrate with any custom system
* ðŸ”Œ **Custom receivers** via webhooks

---

## ðŸ› ï¸ Features of Alertmanager

### âœ… Grouping

* Combine alerts into a single message.
* Example: instead of 100 pod alerts, one grouped â€œPodCrashLoopBackOffâ€ alert.

### âœ… Routing

* Send alerts to different teams.
* Example: Database alerts â†’ DBA team, Node alerts â†’ Infra team.

### âœ… Deduplication

* If an alert is firing repeatedly, only **send once** until itâ€™s resolved.

### âœ… Silences

* Mute alerts temporarily (e.g., during maintenance).
* Configured via API/UI/CLI.

### âœ… Inhibition

* Suppress less severe alerts when a higher severity alert is active.
* Example: Hide â€œdisk usage warningâ€ if â€œdisk full criticalâ€ is active.

---

## ðŸ–¥ï¸ Alertmanager UI

Alertmanager provides a simple web UI (default port `:9093`) where you can:

* View active alerts
* Add silences
* Manage alert history
* Debug routing

---

## ðŸ›¡ï¸ Security Best Practices

* âŒ Donâ€™t expose Alertmanager directly to the internet.
* âœ… Put it behind a **reverse proxy** (Nginx/Traefik).
* âœ… Use **authentication** if exposed.
* âœ… Secure communication between Prometheus and Alertmanager with TLS.

---

## ðŸ” Key Strengths of Alertmanager

* **Deep Prometheus integration** â†’ native in the ecosystem.
* **Powerful routing** â†’ fine-grained alert delivery.
* **Extensible** â†’ webhooks for custom workflows.
* **Silences & inhibition** â†’ reduce noise & alert fatigue.
* **Open-source & widely adopted** â†’ large community.

---

## âš ï¸ Limitations & Watch Outs

* âŒ **Limited UI** (mostly config-driven).
* âŒ **No built-in escalation policies** (PagerDuty is better for escalation chains).
* âŒ **Single binary** â†’ HA requires running multiple instances with a gossip protocol.
* âŒ **Alert storming** still possible if rules arenâ€™t well-tuned.

---

## ðŸ“¦ Alertmanager in the Observability Stack

```mermaid
flowchart TD

    subgraph Metrics
        P[Prometheus]
    end

    subgraph Alerting
        A[Alertmanager]
    end

    subgraph Notifications
        E[Email]
        S[Slack]
        PD[PagerDuty]
        W[Webhook]
    end

    P --> A
    A --> E
    A --> S
    A --> PD
    A --> W
```

ðŸ‘‰ Prometheus **detects**, Alertmanager **notifies**.

---

## ðŸ§¾ Alertmanager Cheat Sheet

### âœ… Core Concepts

| Term           | Meaning                                           |
| -------------- | ------------------------------------------------- |
| **Alert**      | Condition defined in Prometheus that triggers     |
| **Receiver**   | Where alerts are sent (Slack, Email, etc.)        |
| **Route**      | Rules that decide which receiver gets the alert   |
| **Silence**    | Temporary mute for alerts                         |
| **Inhibition** | Suppression of lower alerts when higher ones fire |
| **Grouping**   | Bundling multiple alerts into one notification    |

---

### ðŸ“œ Example Silence Command

```bash
amtool silence add alertname=HighCPUUsage --duration=2h --comment="Maintenance window"
```

---

### ðŸ“Š Example Routing Rule

```yaml
route:
  receiver: 'team-A'
  routes:
    - match:
        team: 'database'
      receiver: 'dba-team'
    - match:
        team: 'infra'
      receiver: 'infra-team'
```

---

## ðŸŽ¯ Final Takeaway

Alertmanager is:

* The **alert distribution hub** for Prometheus.
* Provides **routing, grouping, silencing, inhibition**.
* Supports **many integrations** (Slack, PagerDuty, Email).
* **Essential** for production-grade monitoring.

ðŸ‘‰ Think of Prometheus as the **doctor detecting the illness**, and Alertmanager as the **nurse paging the right specialist**.

---